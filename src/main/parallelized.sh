echo "********************************************************************************************"
echo "****************************************INITIALIZING****************************************"
echo "********************************************************************************************"

ant clean

winners_file="./models/winners.txt"
alphazero_iteration=0
trial=True

while [ $alphazero_iteration -le $1 ]
do
	echo "********************************************************************************************"
	echo "************************************ITERATION ALPHAZERO "$alphazero_iteration"***********************************"
	echo "********************************************************************************************"
	echo "****************************************MCTS TRIALS*****************************************"
	echo "********************************************************************************************"
	if [[ trial ]]
	then
		oarsub -l /nodes=1/core=12,walltime=100:00:00 ant mcts_trials	
	fi
	echo "********************************************************************************************"
	echo "***************************************TRAINING MODEL***************************************"
	echo "********************************************************************************************"
	ant train_model
	if [[ $alphazero_iteration -ge 1 ]]     		# If it's the first step we won't
	then                                    		# go for a dojo since there is only
		echo "********************************************************************************************"
		echo "*****************************************MCTS DOJO******************************************"
		echo "********************************************************************************************"
		oarsub -l /nodes=1/core=12,walltime=100:00:00 ant mcts_dojo
		winner=$( tail -n 1 $winners_file )
		if [[ ${winner::1} == "O" ]]        		# If outsider model won 
		then						# outsider becomes champion
			ant switch_model 			# and we can go back to mcts_trial
			trial=True
		fi
		elif [[ ${winner::1} == "C" ]]     		# If the champion won we need to
		then 						# train the model again without
			trial=False             		# executing mcts_trial
		fi
	((alphazero_iteration++))
done

echo "********************************************************************************************"
echo "*****************************************TRAINING OVER**************************************"
echo "********************************************************************************************"





